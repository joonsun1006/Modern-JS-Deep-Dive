# CH13. 스코프

## 요약 
- JS의 스코프는 계층적구조의 **스코프체인**을 통해 **식별자를 검색하는 규칙**이자,**식별자가 유효한 범위**를 말한다.
- JS의 스코프는 함수를 어디서 **정의**했는지에 따라 함수의 상위 스코프를 결정하는 **렉시컬(정적)스코프**이다.
- 스코프내에서 식별자는 **유일**해야한다. 단 var키워드로 선언된 변수는 중복선언시 var키워드가 없는 것처럼 작동해 **중복선언이 가능**하다.
- var 는 **함수 레벨 스코프**이고 let,const 는 **블록 레벨 스코프**이다.
  
</br>
   
## 자세히
> ### 스코프(scope)란?
다른코드가 식별자(변수이름,함수이름,클래스이름)를 선언된 위치에 따라 참조가 가능한지를 결정하는 유효범위이자   
전체 코드 내에서 어떤 식별자를 참조할것인지 결정하기 위해 식별자를 검색할 때 사용하는 규칙이다.

쉽게 말해 전체 코드 내에서 같은 이름의 변수(혹은 함수)가 존재할 때 **어떤 변수를 참조할것인지를 결정하는 범위이자 규칙**인것이다.   

```jsx
var x = 'global';

function foo() {
  var x = 'local';
  console.log(x); // ① local
}

foo();

console.log(x); //② global 
```

위와같은 예제코드에서 var x 로 선언된 변수가 두개일때 자바스크립트 엔진은 스코프를 통해 어떤 변수를 참조해야 할 것인지 결정한다.   
① 은 해당 스코프가 foo라는 이름의 함수몸체내부인 지역스코프이기 때문에 'local'이 할당된 x를 참조하고 검색을 종료한다.   
② 는 해당 스코프가 전역스코프이기때문에 'global'이 할당된 x를 참조하고 검색을 종료한다.   

</br>

> ### 스코프의 종류
- 전역 스코프
  
  - 코드의 가장 바깥 영역이자 모든 지역 스코프의 최상위 스코프
  - 전역 스코프에 선언된 변수는 전역 변수
- 지역 스코프
  - var :: 함수 레벨 스코프
    
    ```jsx
    // 오직 함수의 코드 블록(함수 몸체)만을 지역 스코프로 인정
    var i = 10;

    // for 문에서 var키워드로 선언한 i는 전역변수. 따라서 중복선언으로 처리됨.
    for(var i = 0; i < 5; i++){
      console.log(i); // 0 1 2 3 4 
    }

    console.log(i); // 5
    ```
  - let,const :: 블록 레벨 스코프
     
    ```jsx
    // 함수 몸체만이 아닌 모든 코드 블록(if,for,while,try/catch)을 지역 스코프로 인정
    let i = 10;

    // for 문에서 let(또는 const)키워드로 선언한 i는 지역변수. 따라서 전역변수인 i에 영향을 끼치지 않음.
    for(let i = 0; i < 5; i++){
      console.log(i); // 0 1 2 3 4 
    }

    console.log(i); // 10
    ```

    

</br>

 > ### 스코프 체인
함수는 중첩될 수 있으므로 함수의 지역 스코프도 중첩될 수 있다. **이는 스코프가 함수의 중첩에 의해 계층적 구조를 갖는다는것을 의미한다.**   
이러한 구조를 **스코프 체인**이라 한다.
</br>  
`💡스코프체인은 실행 컨텐스트의 렉시컬 환경을 단방향으로 연결한 것이다.`

- 스코프 체인에 의한 변수 검색
  - 변수를 참조할 때 자바스크립트 엔진은 스코프 체인을 통해 변수를 참조하는 코드의 스코프에서 시작해 상위 스코프의 방향으로 이동하며 선언된 변수를 검색한다.
  - 상위 스코프에서 유효한 변수는 하위 스코프에서 자유롭게 참조할 수 있지만 하위 스코프에서 유효한 변수를 상위 스코프에서 참조할 수 없다.
 
  
- 스코프 체인에 의한 함수 검색
  ```jsx
  // 전역 함수
  function foo() {
    console.log('global function foo');
  }
  
  function bar() {
    // 중첩 함수
    function foo() {
      console.log('local function foo');
    }
  
    foo(); // ①
  }
  
  bar(); // local function foo
  ```
  - 스코프 체인을 통해 함수 식별자를 검색하기때문에 중첩함수 내에서 foo라는 식별자를 검색하고 종료한다.   
    따라서 위 코드의 결과는 local function foo 이다.
</br>

> ### 렉시컬(정적) 스코프
```jsx
var x = 1;

function foo() {
  var x = 10;
  bar();
}

function bar() {
  console.log(x);
}

foo(); // ?
bar(); // ?
```
위 코드의 실행 결과는 bar 함수의 상위 스코프가 무엇인지에 따라 결정된다. 상위 스코프를 결정하는 방식은 두가지가 있다.

- 동적 스코프(dynamic scope) : 함수를 **어디서 호출**했는지에 따라 상위 스코프 결정
- 정적 스코프(lexical scope) : 함수를 **어디서 정의**했는지에 따라 상위 스코프 결정
</br>
자바크립트를 비롯한 대부분의 프로그래밍 언어는 렉시컬 스코프(정적 스코프)를 따른다.

bar 함수는 호출된 곳이 어디인지 관계없이 언제나 자신이 기억하고 있는, **자신이 정의된 스코프**를 기억한다.   
때문에 위 코드를 실행하면 전역 변수 x의 값 1을 두 번 출력한다.
  

